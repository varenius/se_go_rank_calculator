<html ng-app="rankApp">
<head>
        <meta charset="utf-8"> 
	<title>Rankulatorn</title>
	<link href="css/bootstrap.min.css" rel="stylesheet"></link>
	<link href="css/font-awesome.min.css" rel="stylesheet"></link>
	<!--[if lt IE 9]>
	<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
	<script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
	<![endif]-->
</head>
<body ng-controller="rankCtrl">
        <!--<a href='http://goforbundet.se'><img src='SGF_logga_2013.png' alt='Hem' width = "120px"></a>-->
	<div class="container ng-cloak">
		<h1>Rankulatorn</h1>
		<p>Rankulatorn är ett enastående samt synnerligen magnifikt verktyg för
		att utföra rankkalkyler. Givet en EGD PIN (spelarID) och en önskad rank
		så räknar verktyget ut poängsumman enligt <a
		href="http://goforbundet.se/web/node/30">reglerna för upprankning</a> baserat på
	de matcher som finns inrapporterade i <a href ="http://europeangodatabase.eu">EGD</a>.
	Det resultat som ges här medför inte automatiskt upprankning, men kan
	fungera som ett preliminärt besked innan <a href = "http://goforbundet.se/web/node/28">rankingkommittén</a> kontrollerat
	resultatet.
	</p> <p>Undantag: Rankulatorn tar för närvarande inte hänsyn till
	halvtidspartier.</p>
		<form class="form-horizontal" ng-submit="getGames()">
			<h3>Välj spelare</h3>
			<div class="form-group">
				<label for="search" class="col-sm-2 control-label">EGD-pin</label>
				<div class="col-sm-10">
					<input type="text" class="form-control" ng-model="egdPin" id="search" placeholder="egd-pin">
				</div>
			</div>
			<div class="form-group">
				<div class="col-sm-offset-2 col-sm-10">
					<button type="submit" class="btn btn-primary" ng-disabled="isSearching">
						<i class="fa" ng-class="{'fa-search': !isSearching, 'fa-spin': isSearching, 'fa-spinner': isSearching}"></i>
						Sök
					</button>
				</div>
			</div>
		</form>
		<div ng-show="games.length">
			<h3>Beräkna rank</h3>
			<form class="form-horizontal">
				<div class="form-group">
					<label for="rank" class="col-sm-2 control-label">Önskad rank</label>
					<div class="col-sm-10">
						<select id="rank" class="form-control" ng-options="r.text for r in ranks | filter:selectableRankFilter" ng-model="desiredRank" ng-change="updatePoints()">
							<option value="">-- Välj rank --</option>
						</select>
					</div>
				</div>

			</form>
		</div>
		<div ng-show="games.length">
			<h3>Resultat</h3>
			<div>
				<div ng-show="bestRange.isEnough && danGames.isEnough">
					Du uppfyller alla krav för att bli upprankad till {{desiredRank.text}}! Bra jobbat!
				</div>
				<div ng-show="!(bestRange.isEnough && danGames.isEnough)">
					Du uppfyller inte alla krav för att bli upprankad till {{desiredRank.text}}.
				</div>
				<ul class="fa-ul">
					<li ng-show="bestRange.isEnough"><i class="fa-li fa fa-check fa-lg" style="color: #20C020;"></i>Du har samlat {{bestRange.points.points}} poäng för att nå {{desiredRank.text}}. Poängen har du tjänat på {{bestRange.end-bestRange.start}} matcher f.o.m. {{bestRange.enddate | moment:'YYYY-MM-DD'}} (rond {{bestRange.endround}}) t.o.m. {{bestRange.startdate | moment:'YYYY-MM-DD'}} (rond {{bestRange.startround}}).</li>
					<li ng-show="!bestRange.isEnough"><i class="fa-li fa fa-times fa-lg" style="color: #C02020;"></i>Du har för närvarande maximalt {{bestCurrentRange.points.basePoints}} poäng på {{bestCurrentRange.end-bestCurrentRange.start}} matcher (räknat f.o.m {{bestCurrentRange.enddate | moment:'YYYY-MM-DD'}} rond {{bestCurrentRange.endround}}). Du behöver {{requiredPoints(desiredRank) - bestCurrentRange.points.basePoints}} poäng till.</li>
					<li><i ng-show="!danGames.isEnough" class="fa-li fa fa-times fa-lg" style="color: #C02020;"></i><i ng-show="danGames.isEnough" class="fa-li fa fa-check fa-lg" style="color: #20C020;"></i><ng-pluralize count="danGames.count" when="{
						'0': 'Du har inte vunnit någon match mot {{desiredRank.text}} eller starkare.',
						'one': 'Du har vunnit en match mot {{desiredRank.text}} eller starkare.',
						'other': 'Du har vunnit {} matcher mot {{desiredRank.text}} eller starkare.'}">
                    </ng-pluralize><span ng-show="danGames.required > danGames.count"> <ng-pluralize count="danGames.required - danGames.count" when="{'one': 'Du behöver vinna en sådan match till.', 'other': 'Du behöver vinna {} sådana matcher till.'}"></span></li>
				</ul>
			</div>
			<h3>Partier</h3>
			<table class="table table-condensed">
				<thead>
					<tr>
						<th>Turnering</th>
						<th>Datum</th>
						<th>Rond</th>
						<th>Motståndare</th>
						<th>Rank</th>
						<th>Resultat</th>
						<th>Poäng</th>
						<th>Poängsumma</th>
						<th>Markera</th>
						<th>Nollställ markering</th>
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="g in games" ng-class="{ success: g.result, danger: !g.result }">
						<td><span title="{{g.tournamentName}}">{{g.tournamentCode}}</span></td>
						<td>{{g.date | moment:'YYYY-MM-DD'}}</td>
						<td>{{g.round}}</td>
						<td>{{g.firstName}} {{g.lastName}}</td>
						<td>{{g.rank.text}}</td>
						<td>{{g.result ? 'Vinst' : 'Förlust'}}</td>
						<td>{{pointsForGame(g)}}</td>
						<td>{{pointsForMarkedGames($index)}}</td>
						<td>
							<button class="btn btn-default" ng-show="!isMarked($index)" ng-click="mark($index)">
								<i class="fa fa-plus-circle"></i>
								Markera
							</button>
						</td>
						<td>
							<button class="btn btn-default" ng-show="isMarked($index)"  ng-click="resetMarks()">
								<i class="fa fa-trash-o"></i>
								Nollställ markering
							</button>
						</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
	
	<script src="js/jquery-2.0.3.min.js"></script>
	<script src="js/underscore.js"></script>
	<script src="js/moment-wl.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/angular.min.js"></script>
	<script src="js/rankulator.js"></script>
</body>
</html>
